<div class="video-studio-workspace">
  <!-- Top Navigation Bar (OpenShot style) -->
  <header class="studio-header">
    <div class="header-left">
      <div class="logo-section">
        <div class="studio-logo">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
          </svg>
          <span class="logo-text">OpenShot Studio</span>
        </div>
      </div>
      
      <div class="project-controls">
        <button class="project-btn" (click)="toggleProjectDropdown()">
          <span>{{ currentProjectName }}</span>
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
            <path d="M7,10L12,15L17,10H7Z"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="header-center">
      <div class="playback-controls">
        <button class="control-btn" (click)="seekToFrame(currentFrame - 30)" title="Skip backward 1s">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M11.5,12L20,18V6M11,18V6L2.5,12L11,18Z"/>
          </svg>
        </button>
        
        <button class="play-pause-btn" (click)="togglePlayPause()" [class.playing]="isPlaying">
          <svg *ngIf="!isPlaying" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
          </svg>
          <svg *ngIf="isPlaying" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M14,19H18V5H14M6,19H10V5H6V19Z"/>
          </svg>
        </button>
        
        <button class="control-btn" (click)="seekToFrame(currentFrame + 30)" title="Skip forward 1s">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M13,6V18L21.5,12M4,18L12.5,12L4,6V18Z"/>
          </svg>
        </button>
      </div>

      <div class="time-display">
        <span class="current-time">{{ formatTime(frameToTime(currentFrame)) }}</span>
        <span class="separator">/</span>
        <span class="total-time">{{ formatTime(timeline.duration) }}</span>
        <span class="frame-display">[{{ formatFrame(currentFrame) }}]</span>
      </div>

      <div class="zoom-controls">
        <button class="zoom-btn" (click)="zoomTimelineOut()" title="Zoom out timeline">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,13H5V11H19V13Z"/>
          </svg>
        </button>
        <span class="zoom-level">{{ Math.round(timelineScale) }}px/s</span>
        <button class="zoom-btn" (click)="zoomTimelineIn()" title="Zoom in timeline">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
          </svg>
        </button>
      </div>
    </div>

    <div class="header-right">
      <div class="user-controls">
        <button class="lang-btn" (click)="toggleLanguage()">
          {{ currentLanguage }}
        </button>
        
        <div class="user-avatar">
          <img src="https://images.pexels.com/photos/1239291/pexels-photo-1239291.jpeg?auto=compress&cs=tinysrgb&w=40&h=40&dpr=1" alt="User" />
        </div>
      </div>

      <button class="export-btn" (click)="exportProject()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
        </svg>
        <span>EXPORT</span>
      </button>
    </div>
  </header>

  <!-- Main Content Area -->
  <div class="studio-main">
    <!-- Left Sidebar (OpenShot style) -->
    <aside class="left-sidebar" [class.collapsed]="sidebarCollapsed">
      <div class="sidebar-header">
        <button class="collapse-btn" (click)="toggleSidebar()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z"/>
          </svg>
        </button>
        
        <div class="search-bar" *ngIf="!sidebarCollapsed">
          <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/>
          </svg>
          <input 
            type="text" 
            placeholder="Search project files..." 
            [(ngModel)]="searchQuery"
            (input)="onSearchChange()"
            class="search-input"
          />
        </div>
      </div>

      <nav class="sidebar-nav" *ngIf="!sidebarCollapsed">
        <button 
          class="nav-tab" 
          *ngFor="let tab of navTabs" 
          [class.active]="activeTab === tab.id"
          (click)="setActiveTab(tab.id)"
        >
          <div class="tab-icon" [innerHTML]="tab.icon"></div>
          <span class="tab-label">{{ tab.label }}</span>
        </button>
      </nav>

      <div class="sidebar-content" *ngIf="!sidebarCollapsed">
        <!-- Project Files -->
        <div class="content-panel" *ngIf="activeTab === 'files'">
          <div class="panel-header">
            <h3>Project Files</h3>
            <button class="import-btn" (click)="openImportDialog()">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z"/>
              </svg>
              Import
            </button>
          </div>
          
          <div 
            class="media-grid" 
            *ngIf="filteredMedia.length > 0; else noMediaTemplate"
          >
            <div 
              class="media-item" 
              *ngFor="let media of filteredMedia; trackBy: trackByMediaId"
              cdkDrag="true"
              [cdkDragData]="{ type: 'media', media: media }"
              (click)="selectMedia(media)"
              [class.selected]="selectedMedia?.id === media.id"
              (dblclick)="addMediaToPreview(media)"
            >
              <div class="media-thumbnail">
                <video 
                  *ngIf="media.video" 
                  [src]="media.video" 
                  preload="metadata" 
                  muted
                  crossorigin="anonymous"
                  (error)="onMediaThumbnailError($event, media)"
                  (loadedmetadata)="onThumbnailLoaded($event)"
                ></video>
                <div class="media-placeholder" *ngIf="!media.video">
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                  </svg>
                </div>
                <div class="media-overlay">
                  <div class="play-icon">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="media-info">
                <span class="media-title">{{ media.title }}</span>
                <div class="media-meta">
                  <span class="duration">{{ formatTime(30) }}</span>
                </div>
              </div>
            </div>
          </div>

          <ng-template #noMediaTemplate>
            <div class="empty-state">
              <svg width="48" height="48" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
              </svg>
              <h4>No Project Files</h4>
              <p>Import media files to get started</p>
              <button class="btn-primary" (click)="openImportDialog()">Import Files</button>
            </div>
          </ng-template>
        </div>

        <!-- Transitions Panel -->
        <div class="content-panel" *ngIf="activeTab === 'transitions'">
          <div class="panel-header">
            <h3>Transitions</h3>
          </div>
          <div class="effects-grid">
            <div 
              class="effect-item" 
              *ngFor="let transition of transitions; trackBy: trackByEffectId"
              cdkDrag="true"
              [cdkDragData]="{ type: 'transition', transition: transition }"
              (click)="applyEffectToSelectedClips(transition)"
            >
              <div class="effect-thumbnail">
                <div class="effect-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M18,6V4H6V6H18M6,10V8H18V10H6M6,14V12H18V14H6M6,18V16H18V18H6Z"/>
                  </svg>
                </div>
              </div>
              <span class="effect-name">{{ transition.type }}</span>
            </div>
          </div>
        </div>

        <!-- Effects Panel -->
        <div class="content-panel" *ngIf="activeTab === 'effects'">
          <div class="panel-header">
            <h3>Video Effects</h3>
          </div>
          <div class="effects-grid">
            <div 
              class="effect-item" 
              *ngFor="let effect of videoEffects; trackBy: trackByEffectId"
              cdkDrag="true"
              [cdkDragData]="{ type: 'effect', effect: effect }"
              (click)="applyEffectToSelectedClips(effect)"
            >
              <div class="effect-thumbnail">
                <div class="effect-icon">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2Z"/>
                  </svg>
                </div>
              </div>
              <span class="effect-name">{{ effect.type }}</span>
            </div>
          </div>
        </div>

        <!-- Titles Panel -->
        <div class="content-panel" *ngIf="activeTab === 'titles'">
          <div class="panel-header">
            <h3>Title Templates</h3>
          </div>
          <div class="text-templates">
            <button 
              class="text-item" 
              *ngFor="let template of titleTemplates; trackBy: trackByIndex"
              cdkDrag="true"
              [cdkDragData]="{ type: 'text', template: template }"
              (click)="addTextElement(template)"
            >
              <div class="text-preview">{{ template.preview }}</div>
              <span class="text-name">{{ template.name }}</span>
            </button>
          </div>
        </div>

        <!-- Emojis Panel -->
        <div class="content-panel" *ngIf="activeTab === 'emojis'">
          <div class="panel-header">
            <h3>Emojis & Stickers</h3>
          </div>
          <div class="emoji-grid">
            <div class="emoji-item" *ngFor="let emoji of ['😀', '😂', '😍', '🤔', '👍', '❤️', '🔥', '⭐']">
              <span class="emoji">{{ emoji }}</span>
            </div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Central Preview Area -->
    <main class="preview-area">
      <div 
        class="preview-container"
        cdkDropList="true"
        [cdkDropListData]="{ type: 'preview' }"
        (cdkDropListDropped)="onPreviewDrop($event)"
      >
        <div class="video-preview">
          <video 
            *ngIf="selectedVideoForPreview; else videoPlaceholder" 
            [src]="selectedVideoForPreview" 
            #videoPlayer
            class="preview-video"
            crossorigin="anonymous"
            (loadedmetadata)="onVideoLoaded($event)"
            (timeupdate)="onTimeUpdate($event)"
            (play)="isPlaying = true"
            (pause)="isPlaying = false"
            (error)="onVideoError($event)"
            controls
            preload="metadata"
          ></video>
          
          <ng-template #videoPlaceholder>
            <div class="video-placeholder">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="currentColor">
                <path d="M8,5.14V19.14L19,12.14L8,5.14Z"/>
              </svg>
              <h3>Drop media here to preview</h3>
              <p>Select a video from your project files or drag one here</p>
            </div>
          </ng-template>
        </div>
      </div>
    </main>

    <!-- Right Inspector Panel -->
    <aside class="right-sidebar" [class.collapsed]="inspectorCollapsed">
      <div class="inspector-header">
        <h3>Properties</h3>
        <button class="collapse-btn" (click)="toggleInspector()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
        </button>
      </div>

      <div class="inspector-content" *ngIf="!inspectorCollapsed">
        <div class="inspector-section" *ngIf="selectedClip">
          <h4>Clip Properties</h4>
          <div class="property-group">
            <label>Title</label>
            <input type="text" [(ngModel)]="selectedClip.title" class="property-input" />
          </div>
          <div class="property-group">
            <label>Duration</label>
            <input type="text" [value]="formatTime(selectedClip.duration)" class="property-input" readonly />
          </div>
          <div class="property-group">
            <label>Position</label>
            <input type="number" [(ngModel)]="selectedClip.position" class="property-input" step="0.1" />
          </div>
        </div>

        <div class="inspector-section" *ngIf="selectedClip?.type === 'video'">
          <h4>Transform</h4>
          <div class="property-group">
            <label>Scale</label>
            <div class="slider-group">
              <input type="range" min="0.1" max="3" step="0.1" [(ngModel)]="selectedClip.scale" class="property-slider" />
              <span class="property-value">{{ selectedClip.scale }}x</span>
            </div>
          </div>
          <div class="property-group">
            <label>Rotation</label>
            <div class="slider-group">
              <input type="range" min="-180" max="180" [(ngModel)]="selectedClip.rotation" class="property-slider" />
              <span class="property-value">{{ selectedClip.rotation }}°</span>
            </div>
          </div>
          <div class="property-group">
            <label>Alpha</label>
            <div class="slider-group">
              <input type="range" min="0" max="1" step="0.01" [(ngModel)]="selectedClip.alpha" class="property-slider" />
              <span class="property-value">{{ Math.round(selectedClip.alpha * 100) }}%</span>
            </div>
          </div>
        </div>

        <div class="inspector-section" *ngIf="selectedClip?.type === 'audio'">
          <h4>Audio Properties</h4>
          <div class="property-group">
            <label>Volume</label>
            <div class="slider-group">
              <input type="range" min="0" max="2" step="0.01" [(ngModel)]="selectedClip.volume" class="property-slider" />
              <span class="property-value">{{ Math.round(selectedClip.volume * 100) }}%</span>
            </div>
          </div>
        </div>

        <div class="inspector-section" *ngIf="selectedClip?.effects && selectedClip.effects.length > 0">
          <h4>Applied Effects</h4>
          <div class="effects-list">
            <div class="effect-item" *ngFor="let effect of selectedClip.effects; let i = index">
              <span>{{ effect.type }}</span>
              <button class="remove-effect-btn" (click)="removeEffectFromClip(selectedClip, i)">
                <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </aside>
  </div>

  <!-- Timeline Section (OpenShot style) -->
  <section class="timeline-section" #timelineContainer>
    <div class="timeline-header">
      <div class="timeline-controls">
        <button class="timeline-btn" (click)="fitTimelineToWindow()">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9,9H15V15H9V9M11,11V13H13V11H11M2,3V21H4V19H6V21H8V3H6V5H4V3H2M16,3V21H18V19H20V21H22V3H20V5H18V3H16Z"/>
          </svg>
          Fit
        </button>
        
        <div class="timeline-zoom">
          <input 
            type="range" 
            min="1" 
            max="100" 
            [(ngModel)]="timelineScale" 
            (input)="generateTimelineMarkers()" 
            class="zoom-slider"
          />
          <span>{{ Math.round(timelineScale) }}px/s</span>
        </div>

        <div class="timeline-tools">
          <button 
            class="tool-btn" 
            *ngFor="let tool of tools"
            [class.active]="selectedTool === tool.name" 
            (click)="setTool(tool.name)" 
            [title]="tool.tooltip"
          >
            <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
              <path d="M2,2V4H4V2H2M6,2V4H8V2H6M10,2V4H12V2H10M14,2V4H16V2H14M18,2V4H20V2H18M22,2V4H24V2H22M2,6V8H4V6H2M22,6V8H24V6H22M2,10V12H4V10H2M22,10V12H24V10H22M2,14V16H4V14H2M22,14V16H24V14H22M2,18V20H4V18H2M6,18V20H8V18H6M10,18V20H12V18H10M14,18V20H16V18H14M18,18V20H20V18H18M22,18V20H24V18H22Z"/>
            </svg>
          </button>
        </div>
      </div>
      
      <div class="time-ruler">
        <!-- Time markers will be generated dynamically -->
      </div>
    </div>

    <div class="timeline-tracks">
      <!-- Video Layers -->
      <div *ngFor="let layer of videoLayers; trackBy: trackByLayerId" 
           class="layer video-layer"
           cdkDropList="true"
           [cdkDropListData]="{ type: 'video', layerId: layer.id }"
           (cdkDropListDropped)="onClipDrop($event)">
        
        <div class="layer-controls">
          <div class="layer-buttons">
            <button 
              class="layer-btn mute" 
              [class.active]="mutedLayers[layer.id]" 
              (click)="toggleLayerMute(layer.id)"
              title="Mute Layer"
            >
              M
            </button>
            <button 
              class="layer-btn lock" 
              [class.active]="lockedLayers[layer.id]" 
              (click)="toggleLayerLock(layer.id)"
              title="Lock Layer"
            >
              L
            </button>
          </div>
          <span class="layer-label">{{ layer.label }}</span>
        </div>
        
        <div class="layer-content">
          <div 
            class="clip video-clip" 
            *ngFor="let clip of layer.clips; trackBy: trackByClipId"
            [class.selected]="selectedClips.includes(clip)"
            [style.left.px]="getClipLeft(clip)"
            [style.width.px]="getClipWidth(clip)"
            (click)="selectClip(clip, $event)"
            cdkDrag="true"
            [cdkDragData]="clip"
          >
            <div class="clip-content">
              <div class="clip-thumbnail" *ngIf="clip.thumbnail">
                <img [src]="clip.thumbnail" [alt]="clip.title" />
              </div>
              <div class="clip-info">
                <span class="clip-name">{{ clip.title }}</span>
                <span class="clip-duration">{{ formatTime(clip.duration) }}</span>
              </div>
              <div class="clip-handles">
                <div class="trim-handle left"></div>
                <div class="trim-handle right"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Audio Layers -->
      <div *ngFor="let layer of audioLayers; trackBy: trackByLayerId" 
           class="layer audio-layer"
           cdkDropList="true"
           [cdkDropListData]="{ type: 'audio', layerId: layer.id }"
           (cdkDropListDropped)="onClipDrop($event)">
        
        <div class="layer-controls">
          <div class="layer-buttons">
            <button 
              class="layer-btn mute" 
              [class.active]="mutedLayers[layer.id]" 
              (click)="toggleLayerMute(layer.id)"
              title="Mute Layer"
            >
              M
            </button>
            <button 
              class="layer-btn lock" 
              [class.active]="lockedLayers[layer.id]" 
              (click)="toggleLayerLock(layer.id)"
              title="Lock Layer"
            >
              L
            </button>
          </div>
          <span class="layer-label">{{ layer.label }}</span>
        </div>
        
        <div class="layer-content">
          <div 
            class="clip audio-clip" 
            *ngFor="let clip of layer.clips; trackBy: trackByClipId"
            [class.selected]="selectedClips.includes(clip)"
            [style.left.px]="getClipLeft(clip)"
            [style.width.px]="getClipWidth(clip)"
            (click)="selectClip(clip, $event)"
            cdkDrag="true"
            [cdkDragData]="clip"
          >
            <div class="clip-content">
              <div class="waveform" *ngIf="clip.waveform">
                <div 
                  class="waveform-bar" 
                  *ngFor="let bar of clip.waveform; trackBy: trackByIndex"
                  [style.height.%]="bar"
                ></div>
              </div>
              <div class="clip-info">
                <span class="clip-name">{{ clip.title }}</span>
              </div>
              <div class="clip-handles">
                <div class="trim-handle left"></div>
                <div class="trim-handle right"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Playhead -->
    <div class="playhead" [style.left.px]="getPlayheadLeft()">
      <div class="playhead-line"></div>
      <div class="playhead-handle" (mousedown)="startPlayheadDrag($event)"></div>
    </div>
  </section>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="isLoading">
    <div class="loading-spinner"></div>
    <p>{{ loadingMessage }}</p>
  </div>

  <!-- Export Modal -->
  <div class="export-modal" *ngIf="showExportModal" (click)="closeExportModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Export Video</h2>
        <button class="close-btn" (click)="closeExportModal()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
          </svg>
        </button>
      </div>
      
      <div class="modal-body">
        <div class="export-settings">
          <div class="setting-group">
            <label>Profile</label>
            <select [(ngModel)]="exportSettings.profile" class="setting-select">
              <option value="HD 720p 30 fps">HD 720p 30 fps</option>
              <option value="HD 1080p 30 fps">HD 1080p 30 fps</option>
              <option value="4K 2160p 30 fps">4K 2160p 30 fps</option>
            </select>
          </div>
          
          <div class="setting-group">
            <label>Quality</label>
            <select [(ngModel)]="exportSettings.quality" class="setting-select">
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="ultra">Ultra</option>
            </select>
          </div>
          
          <div class="setting-group">
            <label>Target</label>
            <select [(ngModel)]="exportSettings.target" class="setting-select">
              <option value="mp4">MP4 (H.264)</option>
              <option value="webm">WebM (VP9)</option>
              <option value="mov">MOV (ProRes)</option>
            </select>
          </div>
        </div>
        
        <div class="export-progress" *ngIf="isExporting">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="exportProgress"></div>
          </div>
          <p>Exporting... {{ exportProgress }}%</p>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-secondary" (click)="closeExportModal()" [disabled]="isExporting">Cancel</button>
        <button class="btn btn-primary" (click)="startExport()" [disabled]="isExporting">
          {{ isExporting ? 'Exporting...' : 'Export' }}
        </button>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container">
    <div 
      class="toast" 
      *ngFor="let toast of toasts; trackBy: trackByIndex"
      [class]="'toast-' + toast.type"
      [@slideIn]
    >
      <div class="toast-content">
        <span>{{ toast.message }}</span>
      </div>
      <button class="toast-close" (click)="dismissToast(toast.id)">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Hidden file input for imports -->
  <input 
    type="file" 
    #fileInput 
    style="display: none;" 
    accept="video/*,audio/*,image/*" 
    multiple
    (change)="handleFileImport($event)"
  />
</div>